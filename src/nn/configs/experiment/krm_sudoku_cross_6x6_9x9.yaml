# @package _global_

defaults:
  - override /data: sudoku_cross_6x6_9x9
  - override /model: krm
  - override /callbacks: default
  - override /trainer: gpu

tags: ["sudoku", "krm", "medium"]

timekeeping:
  max_epochs: 450
  batch_size: 64
  num_workers: 0

model_tuning:
  d_model: 256
  d_base: 32
  num_atoms: 8
  num_layers: 4
  num_heads: 4
  ffn_expansion: 4
  hidden_size: 512

  # TRM cycles
  H_cycles: 3
  L_cycles: 5
  N_supervision: 6
  N_supervision_val: 6

  # Position encoding
  position_encoder: 'fourier'  # 'fourier' or 'discrete'
  max_coord: 16
  num_frequencies: 8
  init_bandwidth: 2.0

  # Training
  learning_rate: 1e-4
  learning_rate_emb: 1e-4
  weight_decay: 1.0
  warmup_steps: 20000
  lr_min_ratio: 0.1
  use_constant_lr: false
  max_steps: 0
  halt_exploration_prob: 0.1

  # Position encoding
  rope_theta: 10000
  use_2d_rope: true
  use_kernel_attention: true
  init_bandwidth: 3.0

  # Puzzle embeddings
  puzzle_emb_dim: 0
  puzzle_emb_len: 0

trainer:
  check_val_every_n_epoch: 1

save_dir: /tmp/ml-experiments
append_wandb_name_to_save_dir: true